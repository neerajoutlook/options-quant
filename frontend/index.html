<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Nifty HFT Dashboard</title>
    <link rel="stylesheet" href="/static/css/trading.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Bank Nifty HFT Dashboard
                <span class="mode-badge simulation" id="sim-mode-badge">üéÆ SIMULATION</span>
                <span class="mode-badge paper" id="paper-mode-badge">üìÑ PAPER</span>
                <span id="global-mode-badge" class="mode-badge">PAPER</span>
                <span id="ai-signal" class="ai-signal-badge">AI: --</span>
                <div id="strategy-badges" class="strategy-badges">
                    <span id="badge-hedged" class="s-badge hidden">HEDGED</span>
                    <span id="badge-straddle" class="s-badge hidden">STRADDLE</span>
                    <span id="badge-simulator" class="s-badge hidden">SIMULATOR</span>
                </div>
            </h1>
            <div class="header-actions">
                <div class="mode-toggle-container">
                    <span class="mode-label">AI Auto Trade:</span>
                    <label class="switch">
                        <input type="checkbox" id="auto-trade-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span id="auto-trade-status" class="toggle-state-label off">OFF</span>
                </div>
                <div class="mode-toggle-container">
                    <span class="mode-label">Mode:</span>
                    <label class="switch">
                        <input type="checkbox" id="mode-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span id="mode-status" class="toggle-state-label off">Paper</span>
                </div>
                <div class="qty-controls">
                    <label>Product:
                        <select id="product-type" class="product-select">
                            <option value="I">MIS (Intraday)</option>
                            <option value="C">CNC (Delivery)</option>
                            <option value="M">NRML (Normal)</option>
                        </select>
                    </label>
                    <label>Stock Qty: <input type="number" id="qty-stock" value="1" min="1"></label>
                    <label>Opt Lots: <input type="number" id="qty-option" value="1" min="1"></label>
                </div>
                <button class="btn-panic" onclick="window.priceGrid?.panicExit()">‚ö†Ô∏è PANIC EXIT ALL</button>
                <button class="btn-test-trade" onclick="window.priceGrid?.testTrade()">üß™ Test Trade</button>
            </div>
            <div class="connection-status">
                <span id="status-indicator" class="status-dot disconnected"></span>
                <span id="status-text">Connecting...</span>
            </div>
        </header>

        <div class="main-layout">
            <!-- Left Column: Market Watch -->
            <aside class="col-left market-watch">
                <div class="col-header">
                    <span>üìä MARKET WATCH</span>
                </div>
                <div class="market-tabs">
                    <button class="tab-btn active" onclick="window.priceGrid.switchTab('bears')">üêª Bears</button>
                    <button class="tab-btn" onclick="window.priceGrid.switchTab('bulls')">üêÇ Bulls</button>
                </div>
                <div id="market-list" class="market-list-container">
                    <!-- Dynamic Content -->
                </div>
            </aside>

            <!-- Center Column: Command Deck -->
            <main class="col-center command-deck">
                <!-- Index Overview -->
                <div class="index-overview">
                    <div class="index-card">
                        <div class="index-header">BANKNIFTY</div>
                        <div class="index-price big" id="banknifty-price">--</div>
                        <div class="index-change" id="banknifty-change">--</div>
                    </div>
                    <!-- Placeholder for Nifty if needed later -->
                </div>



                <!-- Active Trades (Expanded) -->
                <div class="active-trades-panel">
                    <div class="panel-header">
                        <span>‚ö° ACTIVE POSITIONS</span>
                        <span id="pos-count" class="badge">0</span>
                    </div>
                    <div class="trades-table-container">
                        <table class="trades-table">
                            <thead>
                                <tr>
                                    <th>SYMBOL</th>
                                    <th>SIDE</th>
                                    <th>QTY</th>
                                    <th>AVG</th>
                                    <th>LTP</th>
                                    <th>VAL</th>
                                    <th>ROI%</th>
                                    <th>P&L</th>
                                    <th>ACT</th>
                                </tr>
                            </thead>
                            <tbody id="positions-table-body">
                                <tr>
                                    <td colspan="9" class="empty-table">No active positions</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Algo Status / Widget Grid -->
                <div id="widget-grid" class="widget-grid">
                    <!-- Options Data Grid -->
                </div>
            </main>

            <!-- Right Column: Activity & Logs -->
            <aside class="col-right activity-log">
                <div class="col-header">
                    <span>üìú ACTIVITY LOG</span>
                </div>

                <!-- Improved Simulation Controls -->
                <div class="sim-controls-panel">
                    <div class="sim-header">
                        <span class="sim-label">SIMULATOR</span>
                        <label class="switch small">
                            <input type="checkbox" id="sim-mode-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div id="sim-speed-controls" class="sim-speed-controls">
                        <label>Speed:</label>
                        <div class="speed-range">
                            <input type="range" min="1" max="10" step="1" value="1" id="sim-speed-range"
                                oninput="document.getElementById('speed-val').innerText = this.value + 'x'">
                            <span id="speed-val">1x</span>
                        </div>
                    </div>
                    <!-- Moved Strategy Threshold Control -->
                    <div class="threshold-control">
                        <div class="control-header">
                            <span>üéØ Threshold</span>
                            <span id="threshold-value" class="threshold-display">2.5</span>
                        </div>
                        <input type="range" id="threshold-slider" min="0.5" max="5.0" step="0.1" value="2.5"
                            class="threshold-slider">
                        <div class="threshold-labels-compact">
                            <span>0.5</span>
                            <span>5.0</span>
                        </div>
                    </div>

                    <!-- Timeframe Control -->
                    <div class="timeframe-control"
                        style="margin-top: 12px; border-top: 1px dashed #222; padding-top: 12px;">
                        <div class="control-header">
                            <span>‚è±Ô∏è Timeframe</span>
                            <span id="tf-value" class="threshold-display" style="font-size: 14px;">5m</span>
                        </div>
                        <select id="timeframe-select" class="product-select" style="width: 100%;">
                            <option value="1">1 Minute</option>
                            <option value="3">3 Minutes</option>
                            <option value="5" selected>5 Minutes</option>
                            <option value="15">15 Minutes</option>
                        </select>
                    </div>
                </div>

                <div class="history-controls">
                    <span class="log-title">Today's Orders</span>
                    <button id="btn-clear-history" class="btn-icon" title="Clear History">üóëÔ∏è</button>
                </div>

                <div id="orders-log" class="orders-log">
                    <div class="empty-log">No recent activity</div>
                </div>
            </aside>
        </div>

        <!-- Performance Metrics -->
        <footer class="metrics">
            <div class="metric">
                <span class="metric-label">Total P&L:</span>
                <span id="total-pnl" class="metric-value pnl-neutral">‚Çπ0.00</span>
            </div>
            <div class="metric">
                <span class="metric-label">Update Rate:</span>
                <span id="fps" class="metric-value">0 fps</span>
            </div>
            <div class="metric">
                <span class="metric-label">Latency:</span>
                <span id="latency" class="metric-value">-- ms</span>
            </div>
            <div class="metric">
                <span class="metric-label">Daily Stop:</span>
                <span id="daily-stop" class="metric-value">‚Çπ0</span>
            </div>
            <div class="metric">
                <span class="metric-label">Symbols:</span>
                <span id="symbol-count" class="metric-value">0</span>
            </div>
        </footer>
    </div>

    <script>
        console.log("üîç INLINE SCRIPT TEST - If you see this, JavaScript works!");
        console.log("üîç Location:", window.location.href);
        console.log("üîç Ready State:", document.readyState);
    </script>
    <script src="/static/js/websocket.js?v=1767633200"></script>
    <script src="/static/js/price-grid.js?v=1767633200"></script>
</body>

</html>